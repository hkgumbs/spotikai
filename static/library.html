<!DOCTYPE html>
<textarea>Loading...</textarea>
<script src="/spotify.js"></script>
<script>
  const token = window.location.hash.slice(1);
  (function getTracks(library = [], params = "limit=50") {
    return spotify("GET", "tracks", params)
      .then(response => response.json())
      .then(body => {
        body.items.forEach(item => library.push(item.track.uri));
        return body.next
          ? getTracks(library, new URL(body.next).search.slice(1))
          : library;
      });
  })().then(library => {
    document.querySelector("textarea").value =
      "const library = [\n" +
      library.map(uri => `  "${uri}",`).join("\n") +
      "\n];"
  });
</script>
